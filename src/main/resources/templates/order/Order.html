<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8"/>
    <title>è¨‚å–®ç®¡ç†é é¢</title>
    <!--    æˆ‘çš„font-awesome-->
    <script
            src="https://kit.fontawesome.com/47b671abbd.js"
            crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <!--å¼•ç”¨SweetAlert2.js-->
    <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.10.3/sweetalert2.js" type="text/javascript"></script>-->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="icon" th:src="@{/img/ClinicxPro.png}">
    <style>
        #content {
            /*width: calc(90% - 250px);*/
            margin-left: 350px;
            /* margin-left: calc(20% - 250px); */
            margin-top: 10px;
            padding: 20px;
            /* border: 5px solid red; */
            height: 800px;
        }

        /*#content {*/
        /*    margin: 0 auto;*/
        /*    padding: 20px;*/
        /*    margin-left: 300px;*/
        /*}*/

        /*é€šçŸ¥ä»˜æ¬¾æŒ‰éˆ•*/
        .btnInfo {
            position: relative;
            /*min-width: 125px;*/
            background: #FFFFFF;
            background: #f2f2f1;
            border: 2px solid red;
            border-radius: 15px;
            overflow: hidden;
        }

        .btnInfo div,
        .btnInfo:before {
            /*font-size: 1em;*/
            font-weight: bold;
            text-transform: uppercase;
            transition: all .3s ease-in-out;
            padding: 5px;
            /*padding: 10px 20px;*/
        }

        .btnInfo:before {
            content: attr(data-hover);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            opacity: 0;
            transform: translate(-100%, 0);
        }

        .btnInfo:hover div {
            opacity: 0;
            transform: translate(100%, 0)
        }

        .btnInfo:hover:before {
            opacity: 1;
            transform: translate(0, 0);
        }

        .btn-primary,
        .btn-danger {
            background-color: #007bff; /* Bootstrap é è¨­çš„ä¸»è¦é¡è‰² */
            opacity: 0.9; /* è¨­ç½®é€æ˜åº¦ï¼Œ0.6 è¡¨ç¤º 60% ä¸é€æ˜åº¦ */
        }

        .btn-kai {
            background-color: #3a6ea5;
        }

        .btnAdd,
        .btnAdd:focus {
            position: relative;
            z-index: 0;
            /*min-width: 200px;*/
            border: 2px solid currentColor;
            border-radius: 48px;
            color: #FF0FF0;
            color: #9d8c56;
            font-size: 1rem;
            text-align: center;
            text-decoration: none;
            overflow: hidden;
            transition: 0.2s transform ease-in-out;
            will-change: transform;
            padding: 10px 20px;
        }

        .btnAdd:after {
            content: '';
            display: block;
            position: absolute;
            height: 100%;
            width: 100%;
            left: 0;
            top: 0;
            z-index: -1;
            background-color: #ff0ff0;
            background-color: #9d8c56;
            border-radius: 3rem;
            transform: translate(-100%, 0) rotate(10deg);
            transform-origin: top left;
            transition: 0.2s transform ease-out;
            will-change: transform;
        }

        .btnAdd:hover:after {
            transform: translate(0, 0);
        }

        .btnAdd:hover {
            border: 2px solid transparent;
            color: #FFFFFF;
            /*æœƒé€ æˆæ¨£å¼æ¨¡ç³Š -> æ”¹è®Šå­—é«”å¤§å°*/
            /*transform: scale(1.05);*/
            transform: scale(1);
            will-change: transform;
        }
    </style>
</head>
<body>
<div th:replace="~{display/Model}"></div>
<main>
    <div class="container-fluid  col-md-10" id="content">
        <!-- ä¸‹é¢æ˜¯æˆ‘çš„åŠŸèƒ½-->
        <div class="page-inner">
            <div
                    class="card-header col-auto col-10 col-lg-10 mt-3 p-2 rounded border"
                    style="
              margin-top: 2%;
              background-color: #1d3d5e;
              color: #f2f2f1;
              border: 1px solid gray;
            "
            >
                <div class="d-flex align-items-center">
                    <h4 class="card-title playfair-display fs-4 border rounded p-2"
                        style="background-color: #3a6ea5; color: #ffffff;">è¨‚å–®ç®¡ç†</h4>
                    <button
                            id="addBtn"
                            class="btnAdd ms-auto"
                    >
                        <!--                            class="btn btn-primary btn-round btn-kai rounded ms-auto"-->
                        <i class="fa-solid fa-square-plus"></i> æ–°å¢è¨‚å–®
                    </button>
                </div>
            </div>
            <!-- éš±è—çš„è¡¨å–® -->
            <form
                    id="deleteForm"
                    method="POST"
                    action="/clinic/deleteOrder"
                    style="display: none"
            >
                <input name="orderNumber" id="deleteInput"/>
                <input type="hidden" name="action" value="delete"/>
            </form>
            <!-- æœå°‹å€åŸŸ -->
            <!-- æœå°‹å€åŸŸ -->
            <!-- æœå°‹å€åŸŸ -->
            <div class="row mt-2">
                <div class="col-auto col-10 col-lg-10 p-2 rounded" style="width: 83%;margin-left: 3px">
                    <div class="card" style="background-color: #f2f2f1">
                        <div class="card-body">
                            <!--                            <h5 class="card-title mb-4">æœå°‹è¨‚å–®</h5>-->
                            <div class="row g-3">
                                <!-- é—œéµå­—æœå°‹ -->
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <button class="btn btn-outline-primary dropdown-toggle" type="button"
                                                id="dropdownMenuButton1" data-bs-toggle="dropdown"
                                                aria-expanded="false">
                                            é—œéµå­—æœå°‹
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                            <li><a class="dropdown-item choose" data-searchtype="patientName">æ‚£è€…</a>
                                            </li>
                                            <li><a class="dropdown-item choose"
                                                   data-searchtype="treatmentItem">ç™‚ç¨‹é …ç›®</a></li>
                                        </ul>
                                        <input type="text" class="form-control" id="Search" placeholder="è¼¸å…¥æœå°‹...">
                                        <button class="btn btn-outline-secondary" type="button" id="SearchBtn">
                                            <i class="fa-solid fa-magnifying-glass"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- ç™‚ç¨‹é€²åº¦æœå°‹ -->
                                <div class="col-md-3">
                                    <div class="input-group">
                                        <label class="input-group-text" for="threapyStatus">ç™‚ç¨‹é€²åº¦</label>
                                        <select id="threapyStatus" class="form-select">
                                            <option value="0">æœªå®Œæˆ</option>
                                            <option value="1">å·²å®Œæˆ</option>
                                        </select>
                                        <button class="btn btn-outline-secondary" type="button" id="SearchByStatusBtn">
                                            <i class="fa-solid fa-magnifying-glass"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- ä»˜æ¬¾ç‹€æ…‹æœå°‹ -->
                                <div class="col-md-3">
                                    <div class="input-group">
                                        <label class="input-group-text" for="payStatus">ä»˜æ¬¾ç‹€æ…‹</label>
                                        <select id="payStatus" class="form-select">
                                            <option value="0">æœªä»˜æ¬¾</option>
                                            <option value="1">å·²ä»˜æ¬¾</option>
                                        </select>
                                        <button class="btn btn-outline-secondary" type="button" id="SearchByStatusBtn2">
                                            <i class="fa-solid fa-magnifying-glass"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- æ—¥æœŸå€é–“æœå°‹ -->
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text">æ—¥æœŸå€é–“</span>
                                        <input type="date" class="form-control" id="startDate"
                                               placeholder="è«‹é¸æ“‡æ™‚é–“...">
                                        <span class="input-group-text">è‡³</span>
                                        <input type="date" class="form-control" id="endDate"
                                               placeholder="è«‹é¸æ“‡æ™‚é–“...">
                                        <button class="btn btn-outline-secondary" type="button" id="SearchBtn2">
                                            <i class="fa-solid fa-magnifying-glass"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <button id="returnAllOrders" class="btn btn-secondary">è¿”å›å…¨éƒ¨è¨‚å–®</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!---------------------------------------------------------------------------------------------------------------------------->
            <!-- ä¸‹é¢æ˜¯è¡¨æ ¼ -->
            <!-- ä¸‹é¢æ˜¯è¡¨æ ¼ -->
            <!-- ä¸‹é¢æ˜¯è¡¨æ ¼ -->
            <div id="" class="row">
                <div class="col-auto col-10 col-lg-10 mt-2">
                    <div class="card" style="background-color: #f2f2f1">
                        <div class="table-responsive">
                            <table
                                    id="orderList"
                                    class="display table table-striped table-hover w-100"
                                    style="padding-bottom: 0;margin-bottom: 0"
                            >
                                <thead>
                                <tr>
                                    <th class="border text-center">è¨‚å–®ç·¨è™Ÿ</th>
                                    <th class="border text-center">æ‚£è€…</th>
                                    <th class="border text-center">ç™‚ç¨‹é …ç›®</th>
                                    <th class="border text-center">ç™‚ç¨‹é€²åº¦</th>
                                    <th class="border text-center">ä»˜æ¬¾ç‹€æ…‹</th>
                                    <th class="border text-center">è¨‚å–®ç”¢ç”Ÿæ—¥æœŸ</th>
                                    <th class="border text-center" style="width: 14%">æ“ä½œ</i>
                                    </th>
                                    <!--                                    <th class="border text-center" style="width: 14%"><i class="fa-solid fa-wrench"></i>-->
                                    <!--                                    </th>-->
                                    <!-- <th id="upTime">è¨‚å–®ä¿®æ”¹æ™‚é–“</th> -->
                                </tr>
                                </thead>
                                <tbody id="orderTbody">
                                <!--å¯«ajax  -->

                                <!--å¯«ajax  -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!--                    ä¸‹é¢æ˜¯åˆ†é çš„éƒ¨åˆ†-->

                    <nav aria-label="Page navigation">
                        <ul class="pagination  justify-content-end mt-3 " id="pagination">
                            <li class="page-item " id="prevPage">
                                <a class="page-link" href="#" tabindex="-1">ä¸Šä¸€é </a>
                            </li>
                            <!-- JSå‹•æ…‹æ’å…¥ é æ•¸ -->
                            <!--.............-->
                            <!-- JSå‹•æ…‹æ’å…¥ é æ•¸ -->
                            <li class="page-item" id="nextPage">
                                <a class="page-link" href="#">ä¸‹ä¸€é </a>
                            </li>
                        </ul>
                    </nav>
                    <div class="text-end" id="pageInfo"></div>

                </div>
            </div>
        </div>
    </div>
</main>
<!--é€™è£é¢æ”¾æˆ‘çš„ Modal -->
<!-- Modal1æ–°å¢è¨‚å–® -->
<div id="addOrderModal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #1d3d5e">
                <h5 class="modal-title text-light">æ–°å¢è¨‚å–®</h5>
                <button
                        id="addVal"
                        class="btnAdd ms-auto text-light"
                        style="background: #9d8c56"
                >
                    ä¸€éµå¸¶å…¥
                </button>
                <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                ></button>
            </div>
            <div class="modal-body">
                <form id="OrderForm" action="/clinic/addOrder" method="post">
                    <input type="hidden" name="action" value="add"/>

                    <div class="form-group">
                        <label for="patientName">æ‚£è€…åç¨± :</label>
                        <input
                                id="OrderName"
                                name="patientName"
                                type="text"
                                class="form-control"
                                placeholder="è«‹è¼¸å…¥æ‚£è€…å§“å"
                                required
                        />
                        <button type="button" class="btn btn-outline-primary mt-2" id="checkPatient">æª¢æŸ¥</button>
                        <span id="patientCheckResult" class="fs-6 form-text text"></span>
                    </div>
                    <div class="form-group">
                        <label for="treatmentItem">ç™‚ç¨‹å…§å®¹ :</label>
                        <select
                                name="treatmentItem"
                                class="form-select form-control"
                                id="OrdertreatmentContent"
                                required
                        >
                            <option value="">è«‹é¸æ“‡ç™‚ç¨‹</option>
                            <!--                            <option>é›·å°„é™¤æ¯›</option>-->
                            <!--                            <option>ç»å°¿é…¸</option>-->
                            <!--                            <option>æ°´é£›æ¢­</option>-->
                            <!--                            <option>éŸ³æ³¢æ‹‰æ</option>-->
                            <!--                            <option>çš®ç§’é›·å°„</option>-->
                            <!--                            <option>é›™çœ¼çš®æ‰‹è¡“</option>-->
                            <!--                            <option>éš†é¼»</option>-->
                            <!--                            <option>æŠ½è„‚</option>-->
                            <!--                            <option>éš†ä¹³</option>-->
                            <!--                            <option>ç—˜ç–¤ï¼Œé™¤æ–‘æ²»ç™‚</option>-->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="threapyStatus">ç™‚ç¨‹ç‹€æ³ :</label>
                        <select
                                name="threapyStatus"
                                class="form-select form-control"
                                id="OrdertreatmentStatus"
                        >
                            <option value="0">æœªå®Œæˆ</option>
                            <option value="1">å·²å®Œæˆ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="doctorName">é†«å¸«åç¨± :</label>
                        <select
                                name="doctorName"
                                class="form-select form-control"
                                id="OrderdoctorSelect"
                                required
                        >
                            <option value="éƒ­ç´¹å¨">éƒ­ç´¹å¨</option>
                            <option value="é™³æŸæƒŸ">é™³æŸæƒŸ</option>
                            <option value="å¾æ˜€æ„·">å¾æ˜€æ„·</option>
                            <option value="æ—è‚²è©³">æ—è‚²è©³</option>
                            <option value="æåŠŸå ¯">æåŠŸå ¯</option>
                            <option value="è¢ä½‘å¬">è¢ä½‘å¬</option>
                            <option value="ææ·»çŸ">ææ·»çŸ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="quote">åƒ¹æ ¼ :</label>
                        <input
                                id="OrderPrice"
                                name="quote"
                                type="number"
                                step="0.01"
                                class="form-control"
                                placeholder=""
                                readonly
                        />
                    </div>

                    <div class="form-group">
                        <label for="payStatus">ä»˜æ¬¾ç‹€æ…‹ :</label>
                        <select
                                name="payStatus"
                                class="form-select form-control"
                                id="OrderpayStatus"
                        >
                            <option value="0">æœªä»˜æ¬¾</option>
                            <option value="1">å·²ä»˜æ¬¾</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="payTool">ä»˜æ¬¾æ–¹å¼ :</label>
                        <select
                                class="form-select form-control"
                                id="OrderpaymentMethod"
                                name="payTool"
                        >
                            <option value="">ç„¡</option>
                            <option value="åŒ¯æ¬¾">åŒ¯æ¬¾</option>
                            <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                            <option value="ç¾é‡‘">ç¾é‡‘</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="payDate">ä»˜æ¬¾æ—¥æœŸ :</label>
                        <input
                                id="OrderpaymentDate"
                                name="payDate"
                                type="date"
                                class="form-control"
                        />
                    </div>

                    <div class="form-group">
                        <label for="orderDate">è¨‚å–®ç”¢ç”Ÿæ—¥æœŸ :</label>
                        <input
                                id="OrderorderDate"
                                name="orderDate"
                                type="date"
                                class="form-control"
                                th:readonly="true"
                                required
                        />
                    </div>

                    <div
                            class="card-action"
                            style="display: flex; justify-content: center"
                    >
                        <button
                                type="submit"
                                id="upConfirmBtn"
                                class="btn btn-success mt-2"
                                style="margin-right: 20px"
                        >
                            æ–°å¢è¨‚å–®
                        </button>
                        <!--                        <button-->
                        <!--                                type="button"-->
                        <!--                                id="CancelBtn"-->
                        <!--                                class="btn btn-danger mt-2"-->
                        <!--                        >-->
                        <!--                            å–æ¶ˆæ–°å¢-->
                        <!--                        </button>-->
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!--MOdal2ä¿®æ”¹è¨‚å–® -->
<div id="upOrderModal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #1d3d5e">
                <h5 class="modal-title text-light">ä¿®æ”¹è¨‚å–®</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="upOrderForm">
                    <div class="form-group">
                        <label for="upOrderNumber">è¨‚å–®ç·¨è™Ÿï¼š</label>
                        <input type="text" class="form-control" id="upOrderNumber" name="orderNumber" readonly>
                    </div>

                    <div class="form-group">
                        <label for="upOrderName">æ‚£è€…åç¨±ï¼š</label>
                        <input type="text" class="form-control" id="upOrderName" name="patientName" readonly>
                    </div>

                    <div class="form-group">
                        <label for="upTreatmentItem">ç™‚ç¨‹å…§å®¹ï¼š</label>
                        <select class="form-control" id="upTreatmentContent" name="treatmentItem" required>
                            <!-- é¸é …å°‡é€šé JavaScript å‹•æ…‹å¡«å…… -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="upTherapyStatus">ç™‚ç¨‹ç‹€æ³ï¼š</label>
                        <select class="form-control" id="upTherapyStatus" name="therapyStatus" required>
                            <option value="0">æœªå®Œæˆ</option>
                            <option value="1">å·²å®Œæˆ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="upDoctorName">é†«å¸«åç¨±ï¼š</label>
                        <select class="form-control" id="upDoctorName" name="doctorName" required>
                            <option value="éƒ­ç´¹å¨">éƒ­ç´¹å¨</option>
                            <option value="é™³æŸæƒŸ">é™³æŸæƒŸ</option>
                            <option value="å¾æ˜€æ„·">å¾æ˜€æ„·</option>
                            <option value="æ—è‚²è©³">æ—è‚²è©³</option>
                            <option value="æåŠŸå ¯">æåŠŸå ¯</option>
                            <option value="è¢ä½‘å¬">è¢ä½‘å¬</option>
                            <option value="ææ·»çŸ">ææ·»çŸ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="upPrice">åƒ¹æ ¼ :</label>
                        <input
                                id="upOrderPrice"
                                name="upPrice"
                                type="number"
                                step="0.01"
                                class="form-control"
                                placeholder=""
                                readonly
                        />
                    </div>
                    <div class="form-group">
                        <label for="upPayStatus">ä»˜æ¬¾ç‹€æ…‹ï¼š</label>
                        <select class="form-control" id="upPayStatus" name="payStatus" required>
                            <option value="0">æœªä»˜æ¬¾</option>
                            <option value="1">å·²ä»˜æ¬¾</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="upPayTool">ä»˜æ¬¾æ–¹å¼ï¼š</label>
                        <select class="form-control" id="upPayTool" name="payTool" required>
                            <option value="ç„¡">ç„¡</option>
                            <option value="åŒ¯æ¬¾">åŒ¯æ¬¾</option>
                            <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                            <option value="ç¾é‡‘">ç¾é‡‘</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="upPayDate">ä»˜æ¬¾æ—¥æœŸï¼š</label>
                        <input type="date" class="form-control" id="upPayDate" name="payDate">
                    </div>

                    <div class="form-group">
                        <label for="upOrderDate">è¨‚å–®ç”¢ç”Ÿæ—¥æœŸï¼š</label>
                        <input type="date" class="form-control" id="upOrderDate" name="orderDate" readonly>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" id="saveUpOrder">ä¿å­˜ä¿®æ”¹</button>
                <button type="button" class="btn btn-danger" id="deleteOrderBtn">åˆªé™¤è¨‚å–®</button>
            </div>
        </div>
    </div>
</div>
<!--===========================================ä¸‹é¢æ˜¯æˆ‘çš„åŠŸèƒ½=====================================-->

<script>
    //==============================================Page=================================
    $(document).ready(function () {

        //ä¸€é–‹å§‹å‚³pageçµ¦å¾Œç«¯ -> å¾0é–‹å§‹
        let currentPage = 0;
        const pageSize = 10;
        //å„²å­˜æœå°‹æ¢ä»¶ é¿å…æœå°‹å¾Œä½¿ç”¨åˆ†é åŠŸèƒ½æ™‚ç™¼ç”ŸéŒ¯èª¤ !!
        let searchParams = null;

        $('#returnAllOrders').on('click', function () {
            searchParams = '';
            // currentPage = 0;
            axios.get('findOrdersByPage')
                .then(response => {
                    const data = response.data;
                    TableHTML(data.content);
                    Pagination(data);
                })
                .catch(error => console.error('è¦ª!æ²’æœ‰æ‹¿åˆ°è³‡æ–™å–” QQ', error));
        })

        //%%%%%% è·Ÿå¾Œç«¯å–å¾—è³‡æ–™ => å†å‘¼å« 1.è¡¨å–®è³‡æ–™å¸«ç”Ÿæˆ & 2.é é¢æ§åˆ¶çš„ function %%%%%%
        function loadOrders(page) {
            let url = 'findOrdersByPage';
            let params = {page: page, size: pageSize};

            //å¦‚æœå­˜åœ¨æœå°‹æ¢ä»¶ => æ ¹æ“šæœå•¥å¾—åˆ°å•¥
            if (searchParams) {
                if (searchParams.startDate || searchParams.endDate) {
                    url = 'findOrdersByDateRange';
                } else {
                    url = 'findOrdersBySerach';
                }
                params = {...params, ...searchParams};
            }

            // axios.get(`findOrdersByPage?page=${page}&size=${pageSize}`)
            //æ ¹æ“šä¸åŒæœå°‹æ¢ä»¶å›å‚³ä¸åŒçš„çµæœ
            axios.get(url, {params: params})
                .then(response => {
                    const data = response.data;
                    TableHTML(data.content);
                    Pagination(data);
                })
                .catch(error => console.error('è¦ª!æ²’æœ‰æ‹¿åˆ°è³‡æ–™å–” QQ', error));
        }

        //åˆ†é çš„æ§åˆ¶
        function Pagination(pageData) {
            const $pagination = $('#pagination');
            const $prevPage = $('#prevPage');
            const $nextPage = $('#nextPage');

            currentPage = pageData.number;
            const totalPages = pageData.totalPages;

            // æ¸…é™¤ç¾æœ‰çš„é ç¢¼æŒ‰éˆ•
            //é™¤äº† prevPage è·Ÿ nextPage ä»¥å¤–çš„
            $pagination.find('li.page-item:not(#prevPage):not(#nextPage)').remove();

            // æ›´æ–°ä¸Šä¸€é æŒ‰éˆ•
            if (pageData.first) {
                $prevPage.addClass('disabled');
            } else {
                $prevPage.removeClass('disabled');
            }
            // æ›´æ–°ä¸‹ä¸€é æŒ‰éˆ•
            // å¦‚æœæ˜¯æœ€å¾Œä¸€é æˆ–ç¸½é æ•¸å°æ–¼ç­‰æ–¼1ï¼Œç¦ç”¨ä¸‹ä¸€é 
            if (pageData.last || totalPages <= 1) {
                $nextPage.addClass('disabled');
            } else {
                $nextPage.removeClass('disabled');
            }

            // æ ¹æ“šç¸½é æ•¸ç”ŸæˆæŒ‰éˆ•
            if (totalPages > 1) {
                const start = Math.max(0, currentPage - 2);
                const end = Math.min(totalPages - 1, currentPage + 2);

                for (let i = start; i <= end; i++) {
                    const $pageItem = $('<li>').addClass('page-item');
                    const $pageLink = $('<a>').addClass('page-link').attr('href', '#').text(i + 1);

                    if (i === currentPage) {
                        $pageItem.addClass('active');
                    }

                    $pageLink.on('click', (e) => {
                        e.preventDefault();

                        loadOrders(i);

                    });

                    $pageItem.append($pageLink);
                    $nextPage.before($pageItem);
                }
            }
            // æ›´æ–°é é¢ä¿¡æ¯
            $('#pageInfo').text(`ç¬¬ ${currentPage + 1} é ï¼Œå…± ${totalPages} é `);
        }

        //æ”¾åœ¨åˆå§‹åŒ–ç‰©ä»¶å¾Œ ->  currentPage
        // ä¸€é–‹å§‹è¼‰å…¥è¡¨æ ¼è³‡æ–™
        loadOrders(currentPage);

// ç¶å®šä¸Šä¸€é å’Œä¸‹ä¸€é çš„é»æ“Šäº‹ä»¶
        $('#prevPage').on('click', function (e) {
            e.preventDefault();
            if (!$(this).hasClass('disabled')) {
                loadOrders(currentPage - 1);
            }
        });

        $('#nextPage').on('click', function (e) {
            e.preventDefault();
            if (!$(this).hasClass('disabled')) {
                loadOrders(currentPage + 1);
            }
        });


        //è¡¨æ ¼ç”¢ç”Ÿè³‡æ–™çš„ function ver2
        function TableHTML(orders) {
            let html = "";
            orders.forEach((order) => {
                let orderDate = new Date(order.orderDate);
                let formattedDate = orderDate.toLocaleDateString('zh-TW', {timeZone: 'Asia/Taipei'});
                //å¯è®“ç”Ÿæˆæ™‚ä¾ç…§ç‹€æ…‹è®Šè‰² ğŸ˜
                const ThreapyColor = order.threapyStatus == 1 ? "color:green" : "color:red";
                const PayColor = order.payStatus == 1 ? "color:green" : "color:red";
                const btnDisplay = order.payStatus == 1 ? "display:none" : "";
                const payBtn = order.payStatus == 1 ? `<td class="border text-center" style="color:green"><i class="fas fa-dollar-sign mr-1"></i>å·²ä»˜æ¬¾</td>` : `<td class="border text-center"><button class="btnInfo btnSendMail" data-hover="é€šçŸ¥ä»˜æ¬¾" style="color: red" data-order="${order.orderNumber}" data-email="${order.patient.patientEmail}"><div><i class="fas fa-dollar-sign mr-1"></i>æœªä»˜æ¬¾</div></button></td>`;

                html += `<tr>
                <td class="border text-center">${order.orderNumber}</td>
                <td class="border text-center">${order.patient.patientName}</td>
                <td class="border text-center">${order.treatment.treatmentName}</td>
                <td class="border text-center " style="${ThreapyColor}">${order.threapyStatus == 1 ? "å·²å®Œæˆ" : "æœªå®Œæˆ"}</td>
                ${payBtn}
                <td class="border text-center">${formattedDate}</td>
                <td class="border  text-center">
                <button class="btnAdd btn-update"  data-order='${JSON.stringify(order)}'><i class="fa-solid fa-wrench"
                      >ç·¨è¼¯è¨‚å–®</i></button>
                </td>
                </tr>`;
            });
            $("#orderTbody").html(html);
        }

        // <td class="border text-center "><button class="btnInfo" ${btnHover} style="${PayColor}"><div><i class="fas fa-dollar-sign mr-1"></i>${order.payStatus == 1 ? "å·²ä»˜æ¬¾" : "æœªä»˜æ¬¾"}</div></button></td>
        // <td class="border text-center "><button class="btnInfo" data-hover="é€šçŸ¥ä»˜æ¬¾" style="${PayColor}"><div><i class="fas fa-dollar-sign mr-1"></i>æœªä»˜æ¬¾</div></button></td>
        // <td class="border text-center " style="${PayColor}">${order.payStatus == 1 ? "å·²ä»˜æ¬¾" : "æœªä»˜æ¬¾"}</td>
        //                     <button class="btn btn-success btn-pay " style="${btnDisplay}"
        //         data-ordernumber="${order.orderNumber}">
        //     ä»˜æ¬¾
        // </button>

        // //    å¯„ä¿¡åŠŸèƒ½à¼¼ ã¤ â—•_â—• à¼½ã¤à¼¼ ã¤ â—•_â—• à¼½ã¤à¼¼ ã¤ â—•_â—• à¼½ã¤
        // $(document).on('click', '.btnSendMail', function () {
        //     const email = $(this).data('email');
        //     swal({
        //         title: 'æ‚¨ç¢ºå®šè¦å¯„é€ä»˜æ¬¾é€šçŸ¥å—?',
        //         // text: 'æ‚¨ç¢ºå®šè¦ç™¼é€ä»˜æ¬¾é€šçŸ¥å—?',
        //         icon: "info",
        //         buttons: true,
        //         dangerMode: true,
        //     }).then((willDelete) => {
        //         if (willDelete) {
        //             axios.post(`/clinic/order/sendEmail`, {email: email})
        //                 .then(function (response) {
        //                     console.log("å¯„é€æˆåŠŸ");
        //                     swal({
        //                         title: "å¯„é€æˆåŠŸ!",
        //                         icon: "success",
        //                     });
        //                 })
        //                 .catch(function (error) {
        //                     console.error('å¯„é€ä¿¡ä»¶æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
        //                     swal({
        //                         title: "å¯„é€å¤±æ•—,ç™¼ç”ŸéŒ¯èª¤!",
        //                         text: "",
        //                         icon: "error",
        //                         buttons: true,
        //                         dangerMode: true,
        //                     })
        //                 });
        //         }
        //     });
        //     // if (confirm('ç¢ºå®šè¦ç™¼é€é€šçŸ¥å—?')) {
        //     //     // axios.post(`/clinic/order/sendEmail?email=${email}`)
        //     //     axios.post(`/clinic/order/sendEmail`, {email: email})
        //     //         .then(function (reponse) {
        //     //             console.log("å¯„é€æˆåŠŸ");
        //     //         })
        //     //         .catch(function (error) {
        //     //             console.error('å¯„é€ä¿¡ä»¶æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
        //     //         })
        //     // } else {
        //     //     alert('å–æ¶ˆç™¼é€');
        //     // }
        // })
        //
        // //    å¯„ä¿¡åŠŸèƒ½à¼¼ ã¤ â—•_â—• à¼½ã¤à¼¼ ã¤ â—•_â—• à¼½ã¤à¼¼ ã¤ â—•_â—• à¼½ã¤

        // < !--ä¸‹æ‹‰é¸å–®çš„js & æœå°‹çš„åŠŸèƒ½-- >
        // < !--ä¸‹æ‹‰é¸å–®çš„js & æœå°‹çš„åŠŸèƒ½-- >
        // < !--ä¸‹æ‹‰é¸å–®çš„js & æœå°‹çš„åŠŸèƒ½-- >

        // æœå°‹é¸å–®å­—é«”æ”¹è®Š
        let SearchType;
        $(".choose").on("click", function () {
            let BtnText = $(this).text();
            $("#dropdownMenuButton1").text(BtnText);
            SearchType = $(this).data('searchtype');
        });
        // å–®é …æœå°‹åŠŸèƒ½
        // å–®é …æœå°‹åŠŸèƒ½
        $('#SearchBtn').on('click', function () {
            let input = $('#Search').val().trim();

            if (!SearchType) {
                alert("é¸æ“‡æœå°‹æ¢ä»¶ ğŸ˜’ğŸ˜’")
                return;
            }
            // æ¯æ¬¡æœå°‹é‡ç½® !!!
            // æ¯æ¬¡æœå°‹é‡ç½® !!!
            // æ¯æ¬¡æœå°‹é‡ç½® !!!
            currentPage = 0;
            searchParams = {[SearchType]: input};
            loadOrders(currentPage);
        })
        // ç¶å®šç™‚ç¨‹é€²åº¦æœå°‹æŒ‰éˆ•
        $('#SearchByStatusBtn').on('click', function () {
            let threapyStatus = $('#threapyStatus').val(); // ç™‚ç¨‹é€²åº¦
            currentPage = 0;
            searchParams = {threapyStatus: threapyStatus}; // è¨­ç½®æœå°‹æ¢ä»¶
            loadOrders(currentPage);
        });
        // ç¶å®šä»˜æ¬¾ç‹€æ…‹æœå°‹æŒ‰éˆ•
        $('#SearchByStatusBtn2').on('click', function () {
            let payStatus = $('#payStatus').val(); // ä»˜æ¬¾ç‹€æ…‹
            currentPage = 0;
            searchParams = {payStatus: payStatus}; // è¨­ç½®æœå°‹æ¢ä»¶
            loadOrders(currentPage);
        });

        // æ—¥æœŸå€é–“æœå°‹åŠŸèƒ½
        // æ—¥æœŸå€é–“æœå°‹åŠŸèƒ½
        $('#SearchBtn2').on('click', function () {
            let startDate = $('#startDate').val();
            let endDate = $('#endDate').val();

            //å…©å€‹éƒ½è¦é¸æ“‡
            if (!startDate || !endDate) {
                alert("è«‹é¸æ“‡å®Œæ•´çš„æ—¥æœŸå€é–“");
                return;
            }
            // ç¢ºä¿çµæŸæ—¥æœŸä¸æ—©æ–¼é–‹å§‹æ—¥æœŸ â¤ï¸
            if (new Date(endDate) < new Date(startDate)) {
                alert("çµæŸæ—¥æœŸä¸èƒ½æ—©æ–¼é–‹å§‹æ—¥æœŸ!!!");
                return;
            }
            // æ¯æ¬¡æœå°‹é‡ç½® !!!
            // æ¯æ¬¡æœå°‹é‡ç½® !!!
            // æ¯æ¬¡æœå°‹é‡ç½® !!!
            currentPage = 0;
            searchParams = {startDate: startDate, endDate: endDate};
            loadOrders(currentPage);
        });

        // =====================================================æ–°å¢ç›¸é—œ======================================
        // å„²å­˜æª¢æŸ¥éçš„æ‚£è€…ID
        let currentPatientId = null;
        // æª¢æŸ¥æ‚£è€…å­˜åœ¨èˆ‡å¦
        $('#checkPatient').on('click', function () {
            const patientName = $('#OrderName').val();
            if (patientName) {
                checkPatient(patientName);
            } else {
                $('#patientCheckResult').text('è«‹è¼¸å…¥æ‚£è€…å§“å').addClass('text-danger');
            }
        });

        // æª¢æŸ¥æ‚£è€…å‡½æ•¸ 1.æª¢æŸ¥æ›æ‚£è€…å­˜åœ¨èˆ‡å¦ 2.çµ¦äºˆæ‚£è€…ID checkPatient
        function checkPatient(patientName) {
            axios.get(`/clinic/api/orders/check?patientName=${patientName}`)
                .then(function (response) {
                    if (response.data.exists) {
                        $('#patientCheckResult').text('æ‚£è€…å­˜åœ¨').removeClass('text-danger').addClass('text-success');
                        currentPatientId = response.data.patientId;
                        $('#addBtn').prop('disabled', false); // å•Ÿç”¨æ–°å¢æŒ‰éˆ•
                    } else {
                        $('#patientCheckResult').text('æ‚£è€…ä¸å­˜åœ¨').removeClass('text-success').addClass('text-danger');
                        currentPatientId = null;
                        $('#addBtn').prop('disabled', true); // ç¦ç”¨æ–°å¢æŒ‰éˆ•
                    }
                })
                .catch(function (error) {
                    console.error('æª¢æŸ¥æ‚£è€…æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                    $('#patientCheckResult').text('æ­¤åæ‚£è€…ä¸å­˜åœ¨').addClass('text-danger');
                    currentPatientId = null;
                    $('#addBtn').prop('disabled', true); // ç¦ç”¨æ–°å¢æŒ‰éˆ•
                });
        }

        // ç²å–æ‰€æœ‰ç™‚ç¨‹
        axios.get('/clinic/api/orders/treatments')
            .then(function (response) {
                const treatments = response.data;
                const select = $('#OrdertreatmentContent');
                const upSelect = $('#upTreatmentContent');
                //æ–°å¢è¡¨å–®
                treatments.forEach(function (treatment) {
                    select.append($('<option>', {
                        value: treatment.treatmentId,
                        text: treatment.treatmentName,
                        'data-price': treatment.price
                    }));
                });
                //ä¿®æ”¹è¡¨å–®
                treatments.forEach(function (treatment) {
                    upSelect.append($('<option>', {
                        value: treatment.treatmentId,
                        text: treatment.treatmentName,
                        'data-price': treatment.price
                    }));
                });
            })
            .catch(function (error) {
                console.error('ç²å–ç™‚ç¨‹å¤±æ•—:', error);
            });

        // ç•¶é¸æ“‡æ”¹è®Šæ™‚æ›´æ–°åƒ¹æ ¼  -----æ–°å¢
        $('#OrdertreatmentContent').change(function () {
            const selectedOption = $(this).find('option:selected');
            const price = selectedOption.data('price');
            $('#OrderPrice').val(price);
        });
        // ç•¶é¸æ“‡æ”¹è®Šæ™‚æ›´æ–°åƒ¹æ ¼ ------ä¿®æ”¹
        $('#upTreatmentContent').change(function () {
            const selectedOption = $(this).find('option:selected');
            const price = selectedOption.data('price');
            $('#upOrderPrice').val(price);
        });

        // ä¸€éµå¸¶å…¥
        $("#addVal").on("click", function () {
            // å¸¶å…¥çš„å€¼
            let testData = {
                name: "ç‹å°æ˜",
                treatmentContent: "T008",
                doctorName: "éƒ­ç´¹å¨"
            };
            //å¸¶å…¥å€¼
            $("#OrderName").val(testData.name);
            $("#OrderdoctorSelect").val(testData.doctorName);
            //æ”¹æˆè§¸ç™¼é¸æ“‡ => å¯ä»¥è‡ªå‹•å¸¶å…¥åƒ¹æ ¼
            $("#OrdertreatmentContent").val(testData.treatmentContent).trigger('change');
            // $("#OrdertreatmentContent").val(testData.treatmentContent);
            // $("#OrderPrice").val(price);
            // æª¢æŸ¥æ‚£è€…
            checkPatient(testData.name);
        });

        //æ–°å¢è¨‚å–®æŒ‰éˆ•
        $('body').on("click", "#addBtn", function () {
            //è¨‚å–®æ—¥æœŸè‡ªå‹•å¸¶å€¼
            const options = {year: 'numeric', month: '2-digit', day: '2-digit', timeZone: 'Asia/Taipei'};
            const today = new Intl.DateTimeFormat('zh-TW', options).format(new Date());
            const formattedDate = today.split('/').join('-'); // å°‡ / æ›¿æ›ç‚º -
            $("#OrderorderDate").val(formattedDate);

            $("#addOrderModal").modal("show");

            //å¯èƒ½æœƒè·³é‡è¤‡ç¶å®šäº‹ä»¶çš„éŒ¯èª¤
            $("#OrderForm").off("submit");
            //æäº¤è¡¨å–®
            $("#OrderForm").on("submit", function (e) {
                e.preventDefault();

                swal({
                    title: "ç¢ºå®šè¦æ–°å¢å—ï¼Ÿ",
                    text: "",
                    icon: "info",
                    buttons: true,
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {
                            if (!currentPatientId) {
                                swal({
                                    title: "è«‹å…ˆæª¢æŸ¥æ‚£è€…æ˜¯å¦å­˜åœ¨ï¼",
                                    icon: "",
                                });
                                return;
                            }
                            let formData = {
                                orderNumber: "",
                                patient: {
                                    patientId: currentPatientId
                                },
                                treatment: {
                                    treatmentId: $('#OrdertreatmentContent').val()
                                },
                                threapyStatus: $('#OrdertreatmentStatus').val(),
                                doctorName: $('#OrderdoctorSelect').val(),
                                payStatus: $('#OrderpayStatus').val(),
                                payTool: $('#OrderpaymentMethod').val(),
                                payDate: $('#OrderpaymentDate').val(),
                                orderDate: $('#OrderorderDate').val(),
                            };
                            axios.post('/clinic/api/orders', formData)
                                .then(function (response) {
                                    $("#addOrderModal").modal("hide");
                                    loadOrders(currentPage);
                                    swal({
                                        title: "æ–°å¢æˆåŠŸ!",
                                        icon: "success",
                                    });
                                })
                                .catch(function (error) {
                                    console.log("ErroréŒ¯èª¤ç™¼ç”Ÿ", error);
                                    swal({
                                        title: "æ–°å¢å¤±æ•—,ç™¼ç”ŸéŒ¯èª¤!",
                                        text: "",
                                        icon: "error",
                                        buttons: true,
                                        dangerMode: true,
                                    })
                                })
                        } else {
                            swal({
                                title: "å–æ¶ˆæ–°å¢!",
                            });
                        }
                    });
            });
        });
        //é»æ“Šå–æ¶ˆmodalæ¶ˆå¤±
        $("#CancelBtn").on("click", function () {
            $("#addOrderModal").modal("hide");
        });

        //ä¿®æ”¹è¨‚å–®
        $(document).on("click", ".btn-update", function () {
            let order = $(this).data("order");
            let orderNumber = $('upOrderNumber').val();
            let upPatientId = order.patient.patientId;

            //çµ¦é è¨­å€¼
            $("#upOrderModal").modal("show");
            $("#upOrderNumber").val(order.orderNumber);
            $("#upOrderName").val(order.patient.patientName);
            // $("#upTreatmentContent").val(order.treatment.treatmentName);
            //å¼·åˆ¶é¸æ“‡
            $("#upTreatmentContent").val(order.treatment.treatmentId).trigger('change');
            $("#upTherapyStatus").val(order.threapyStatus);
            $("#upDoctorName").val(order.doctorName);
            $("#upOrderPrice").val(order.treatment.price);
            $("#upPayStatus").val(order.payStatus);
            if (order.payTool == null || typeof (order.payTool) == 'undefined' || order.payTool == '') {
                // $("#upPayTool").val("ç„¡").trigger('change');
                $("#upPayTool").val("ç„¡");
            } else {
                $("#upPayTool").val(order.payTool);
            }
            //æ—¥æœŸ
            $("#upPayDate").val(order.payDate);
            $("#upOrderDate").val(order.orderDate);
            //å–æ¶ˆé‡è¤‡ç¶å®š
            $("#upOrderForm").off("submit");
            //æäº¤ä¿®æ”¹è¡¨å–®

            // ç„¶å¾Œç¶å®šæ–°çš„ submit äº‹ä»¶è™•ç†ç¨‹åº
            // $("#upOrderForm").on("submit", function (e) {
            $("#saveUpOrder").on("click", function (e) {
                // e.preventDefault();
                swal({
                    title: "ç¢ºå®šè¦ä¿®æ”¹å—ï¼Ÿ",
                    text: "",
                    icon: "info",
                    buttons: true,
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {
                            let orderNumber = $('#upOrderNumber').val();
                            let upformData = {
                                orderNumber: $('#upOrderNumber').val(),
                                patient: {
                                    patientId: upPatientId
                                },
                                treatment: {
                                    treatmentId: $('#upTreatmentContent').val()
                                },
                                treatmentItem: $('#upTreatmentContent').val(),
                                threapyStatus: $('#upTherapyStatus').val(),
                                doctorName: $('#upDoctorName').val(),
                                quote: $('#upOrderPrice').val(),
                                payStatus: $('#upPayStatus').val(),
                                payTool: $('#upPayTool').val(),
                                payDate: $('#upPayDate').val(),
                                orderDate: $('#upOrderDate').val(),
                            };
                            axios.put(`/clinic/api/orders/${orderNumber}`, upformData)
                                .then(function (response) {
                                    $("#upOrderModal").modal("hide");
                                    loadOrders(currentPage);
                                    swal({
                                        title: "ä¿®æ”¹æˆåŠŸ!",
                                        icon: "success",
                                    });
                                })
                                .catch(function (error) {
                                    console.log("ErroréŒ¯èª¤ç™¼ç”Ÿ", error);
                                    swal({
                                        title: "ä¿®æ”¹å¤±æ•—,ç™¼ç”ŸéŒ¯èª¤!",
                                        text: "",
                                        icon: "error",
                                        buttons: true,
                                        dangerMode: true,
                                    })
                                })
                        } else {
                            swal({
                                title: "å–æ¶ˆä¿®æ”¹!",
                            });
                        }
                    });
            });
            // ç¶å®šåˆªé™¤è¨‚å–®çš„é»æ“Šäº‹ä»¶
            $("#deleteOrderBtn").off("click").on("click", function () {
                swal({
                    title: "ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ",
                    text: "ä¸€æ—¦åˆªé™¤ï¼Œè³‡æ–™ç„¡æ³•å¾©åŸ!",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {
                            let orderNumber = $('#upOrderNumber').val();
                            axios.delete(`/clinic/api/orders/${orderNumber}`)
                                .then(function (response) {
                                    $('#upOrderModal').modal('hide');
                                    loadOrders(currentPage);
                                    swal({
                                        title: "åˆªé™¤æˆåŠŸ",
                                        icon: "success",
                                    });
                                })
                                .catch(function (error) {
                                    console.log('ErroréŒ¯ç‰©', error);
                                    swal({
                                        title: "åˆªé™¤å¤±æ•—,ç™¼ç”ŸéŒ¯èª¤!",
                                        text: "",
                                        icon: "error",
                                        buttons: true,
                                        dangerMode: true,
                                    })
                                })
                        } else {
                            swal({
                                title: "å–æ¶ˆåˆªé™¤",
                            });
                        }
                    });
            });

        });

        //ECPAY
        // ç¶ ç•Œç§‘æŠ€æ”¯ä»˜è«‹æ±‚
        $(document).on('click', '.btn-pay', function () {
            const orderNumber = $(this).data('ordernumber');

            // é¦–å…ˆç²å–è¨‚å–®è©³æƒ…
            axios.get(`/clinic/api/orders/${orderNumber}`)
                .then(response => {
                    const order = response.data;
                    // ç™¼é€æ”¯ä»˜è«‹æ±‚
                    return axios.post('/clinic/ecpay/checkout', order);
                })
                .then(response => {
                    const formHtml = response.data;
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = formHtml;
                    document.body.appendChild(tempDiv);
                    const form = tempDiv.querySelector('form');
                    if (form) {
                        form.submit();
                    } else {
                        console.error('ç„¡æ³•æ‰¾åˆ°è¡¨å–®å…ƒç´ ');
                    }
                })
                .catch(error => {
                    console.error('æ”¯ä»˜è«‹æ±‚å¤±æ•—:', error);
                    alert('æ”¯ä»˜è«‹æ±‚å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                });
        });


        //-----------------------------------ä»¥ä¸‹æ˜¯ç™¼é€emailçš„ JS-------------------------------------------
        //    å¯„ä¿¡åŠŸèƒ½à¼¼ ã¤ â—•_â—• à¼½ã¤à¼¼ ã¤ â—•_â—• à¼½ã¤à¼¼ ã¤ â—•_â—• à¼½ã¤
        $(document).on('click', '.btnSendMail', async function () {
            const email = $(this).data('email');
            // axios çš„å–æ¶ˆè«‹æ±‚åŠŸèƒ½
            const CancelToken = axios.CancelToken;
            const source = CancelToken.source();

            try {
                // ç¢ºèªç™¼é€
                const willSend = await swal({
                    title: 'ç¢ºèªç™¼é€ä»˜æ¬¾é€šçŸ¥',
                    text: `å³å°‡ç™¼é€éƒµä»¶è‡³ï¼š${email}`,
                    icon: 'warning',
                    buttons: {
                        cancel: {
                            text: "å–æ¶ˆ",
                            value: null,
                            visible: true
                        },
                        confirm: {
                            text: "ç¢ºå®šç™¼é€",
                            value: true
                        }
                    }
                });

                if (willSend) {
                    // ç™¼é€ä¸­ç‹€æ…‹
                    swal({
                        title: "è™•ç†ä¸­...",
                        text: "æ­£åœ¨ç™¼é€éƒµä»¶",
                        icon: "info",
                        buttons: false,
                        // buttons: {
                        //     cancel: {
                        //         text: "å–æ¶ˆç™¼é€",
                        //         value: null,
                        //         visible: true,
                        //         className: "",
                        //         closeModal: false,
                        //     }
                        // },
                        closeOnClickOutside: false,
                        closeOnEsc: false
                    });

                    // ç™¼é€éƒµä»¶
                    const response = await axios.post('/clinic/order/sendEmail', {
                        email: email
                    }, {cancelToken: source.token});

                    if (response.status === 200) {
                        // ç™¼é€æˆåŠŸ
                        await swal({
                            title: "ç™¼é€æˆåŠŸï¼",
                            text: "ä»˜æ¬¾é€šçŸ¥å·²ç™¼é€",
                            icon: "success",
                            timer: 1500,
                            buttons: false
                        });
                    }
                }
            } catch (error) {
                console.error('å¯„é€ä¿¡ä»¶æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);

                // éŒ¯èª¤è™•ç†
                await swal({
                    title: "ç™¼é€å¤±æ•—",
                    text: error.response?.data || "ç™¼é€éƒµä»¶æ™‚ç™¼ç”ŸéŒ¯èª¤",
                    icon: "error",
                    button: "ç¢ºå®š"
                });
            }
        });
//    å¯„ä¿¡åŠŸèƒ½à¼¼ ã¤ â—•_â—• à¼½ã¤à¼¼ ã¤ â—•_â—• à¼½ã¤à¼¼ ã¤ â—•_â—• à¼½ã¤
    });
    // })
</script>
</body>
</html>
